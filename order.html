<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Checkout — ET Naturals</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0b0b0c; --card:#151618; --text:#f6f7f9; --muted:#9aa3ae; --stroke:#2a2d31; --accent:#52a5ff; }
    * { box-sizing:border-box; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:var(--text); }
    .wrap { max-width:720px; margin:32px auto; padding:20px; }
    a { color:var(--accent); text-decoration:none; }
    header { margin-bottom:12px; }
    .card { background:var(--card); border-radius:14px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,.35); }
    .row { display:grid; grid-template-columns:1fr; gap:18px; }
    label { display:flex; flex-direction:column; gap:6px; font-size:14px; }
    select, input[type="number"] {
      background:#0f1012; border:1px solid var(--stroke); color:var(--text);
      padding:10px 12px; border-radius:10px; font-size:15px;
    }
    .totals { font-size:15px; color:var(--muted); }

    /* Payment row layout — let PayPal choose its natural width */
    .paygrid{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
      margin-top:6px;
    }
    /* Ensure the hosted button isn’t squeezed */
    #paypal-container{
      flex:0 1 320px;
      min-width:320px;
    }
    /* Venmo image */
    .payimg{
      width:200px; max-width:200px; height:auto;
      border-radius:12px; border:1px solid #2a2d31; box-shadow:0 2px 8px rgba(0,0,0,.25);
      display:block;
    }
    .paygrid a:focus-visible img, .paygrid a:hover img { outline:2px solid var(--accent); outline-offset:3px; }
    @media (max-width:520px){
      #paypal-container{ min-width:260px; }
      .payimg{ width:180px; max-width:180px; }
    }

    .toast {
      position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
      background:#151618; color:#f6f7f9; border:1px solid var(--stroke);
      padding:10px 14px; border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,.35);
      font-size:14px; display:none; z-index:9999;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header><a href="/">← Back</a></header>

    <div class="card">
      <h1 style="margin:0 0 10px 0;">Checkout</h1>

      <div class="row">
        <label>
          Plan
          <select id="plan">
            <option value="onetime">One-Time — $19.99</option>
            <option value="subscribe">Subscription — $14.99</option>
            <option value="bundle">Bundle (3-Pack) — $54.99</option>
          </select>
        </label>

        <label>
          Quantity
          <input id="qty" type="number" min="1" value="1" />
        </label>

        <div class="totals" id="totals">Total: $19.99</div>

        <!-- Payment row -->
        <div class="paygrid">
          <!-- PayPal Hosted Button renders here -->
          <div id="paypal-container"></div>

          <!-- Venmo image/link -->
          <a href="#" id="lnkVenmo" aria-label="Pay with Venmo">
            <img class="payimg" src="images/venmo.png" alt="Pay with Venmo"
                 onerror="this.onerror=null; this.src='venmo.png';">
          </a>
        </div>
      </div>

      <p class="totals" style="margin-top:10px;">Taxes &amp; shipping calculated in payment app.</p>
    </div>
  </div>

  <div class="toast" id="toast">Coming soon.</div>

  <!-- PayPal SDK (Hosted Buttons) -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAAKoYuCKyWqy1Jy8Vf1kY4Ko_WokiJ5hGLAuWQkPZ2TGDxblPddJHUiuuj5jKgI-QMM37FFgejZi1LhJE&components=hosted-buttons&currency=USD"></script>

  <!-- App logic -->
  <script>
  (function(){
    // === CONFIG ===
    const PRICES = { onetime: 19.99, subscribe: 14.99, bundle: 54.99 };
    const STORE_NAME = 'ET Naturals';
    const VENMO_HANDLE = 'YOUR_VENMO_HANDLE'; // <- set your Venmo username (no @)

    // ✅ Your PayPal Hosted Button IDs
    const BUTTON_IDS = {
      subscribe: 'JHVUFW77DLZ62', // $14.99 subscription
      onetime:   'P6L48JKW53W5J', // $19.99 one-time
      bundle:    '6EXMRWBD9LCTQ'  // $54.99 bundle
    };

    // Elements
    const planEl = document.getElementById('plan');
    const qtyEl  = document.getElementById('qty');
    const totEl  = document.getElementById('totals');
    const venmoA = document.getElementById('lnkVenmo');

    // Helpers
    const isMobile = () => /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const planLabel = (p) => p==='subscribe'?'Subscription':(p==='bundle'?'Bundle (3-Pack)':'One-Time');

    function parseQueryPlan(){
      const p = new URLSearchParams(location.search).get('plan');
      if (p && ['onetime','subscribe','bundle'].includes(p)) planEl.value = p;
    }

    function calc(){
      const plan = planEl.value || 'onetime';
      const qty = Math.max(1, parseInt(qtyEl.value||'1',10));
      const unit = PRICES[plan] ?? PRICES.onetime;
      // Hosted buttons use amounts defined in PayPal; qty is for Venmo + display only
      const total = +(unit * (plan==='subscribe' ? 1 : qty)).toFixed(2);
      return { plan, qty, unit, total };
    }

    function updateTotals(){
      const { total, qty, unit, plan } = calc();
      totEl.textContent = `Total: $${total.toFixed(2)} (${qty} × $${unit.toFixed(2)})` + (plan==='subscribe'?' / 30 days':'');
    }

    function updateVenmo(){
      const { plan, qty, total } = calc();
      const label = `${STORE_NAME} — ${planLabel(plan)}${plan==='bundle'?'':(' ×'+qty)}`;
      const amount = total.toFixed(2);
      const note = encodeURIComponent(label);
      if (VENMO_HANDLE && VENMO_HANDLE !== 'YOUR_VENMO_HANDLE') {
        const deep = `venmo://paycharge?txn=pay&recipients=${encodeURIComponent(VENMO_HANDLE)}&amount=${amount}&note=${note}`;
        const web  = `https://venmo.com/${encodeURIComponent(VENMO_HANDLE)}?txn=pay&amount=${amount}&note=${note}`;
        venmoA.href = isMobile() ? deep : web;
      } else {
        venmoA.href = '#';
      }
    }

    // PayPal Hosted Button render (by plan)
    function renderPayPal(){
      const container = document.getElementById('paypal-container');
      if (!container || typeof paypal === 'undefined' || !paypal.HostedButtons) return;

      const { plan } = calc();
      const id = BUTTON_IDS[plan];

      container.innerHTML = ''; // clear previous render
      paypal.HostedButtons({ hostedButtonId: id }).render('#paypal-container');
    }

    // Init
    parseQueryPlan();
    updateTotals();
    updateVenmo();
    renderPayPal();

    // Events
    planEl.addEventListener('change', () => { updateTotals(); updateVenmo(); renderPayPal(); });
    qtyEl.addEventListener('input', () => { updateTotals(); updateVenmo(); });
  })();
  </script>
</body>
</html>
