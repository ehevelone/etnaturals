<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Thank You — ET Naturals</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0b0b0c; --card:#151618; --text:#f6f7f9; --muted:#9aa3ae; --stroke:#2a2d31; --accent:#52a5ff; }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:720px;margin:12vh auto 0;padding:24px}
    .card{background:var(--card);border-radius:14px;padding:28px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    h1{margin:0 0 8px}
    p{color:var(--muted);margin:.5rem 0 0}
    .row{display:grid;gap:14px;margin-top:16px}
    .summary{border:1px solid var(--stroke);border-radius:12px;padding:14px;background:#0f1012}
    .line{display:flex;justify-content:space-between;gap:12px}
    .total{font-weight:800}
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
    .btn{appearance:none;border:1px solid var(--stroke);background:#0f1012;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
    .emailbox{display:flex;gap:8px;flex-wrap:wrap}
    input[type="email"]{background:#0f1012;border:1px solid var(--stroke);color:var(--text);padding:10px 12px;border-radius:10px;min-width:240px}
    a{color:var(--accent);text-decoration:none}
    .note{font-size:12px;color:#9aa3ae;margin-top:8px}
    .sent{font-size:12px;color:#9bd18f;margin-top:8px;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Thank you!</h1>
      <p>We received your order. PayPal emailed a receipt. Your summary is below.</p>

      <div id="summary" class="summary" aria-live="polite">
        <!-- populated by JS -->
      </div>

      <div class="actions">
        <button class="btn" id="btnPrint">Print / Save PDF</button>
        <div class="emailbox">
          <input type="email" id="email" placeholder="your@email.com" aria-label="Email address">
          <button class="btn" id="btnEmail">Email me this summary</button>
        </div>
      </div>

      <p class="note">If anything looks off, reply to your PayPal receipt or email us at <a href="mailto:etnaturals@outlook.com">etnaturals@outlook.com</a>.</p>
      <p class="sent" id="sent">Order notification sent.</p>

      <!-- Hidden Netlify form (registered at build time) -->
      <form name="order-notify" netlify netlify-honeypot="bot-field" hidden>
        <input type="hidden" name="form-name" value="order-notify">
        <input type="text"   name="plan">
        <input type="text"   name="qty">
        <input type="text"   name="unit">
        <input type="text"   name="total">
        <input type="text"   name="timestamp">
      </form>
    </div>
  </div>

 <!-- PayPal SDK (Hosted Buttons only) -->
<script src="https://www.paypal.com/sdk/js?client-id=BAAKoYuCKyWqy1Jy8Vf1kY4Ko_WokiJ5hGLAuWQkPZ2TGDxblPddJHUiuuj5jKgI-QMM37FFgejZi1LhJE&components=hosted-buttons&currency=USD"></script>

<script>
(function(){
  // === CONFIG (your real IDs) ===
  const BUTTON_IDS = {
    subscribe: 'JHVUFW77DLZ62', // $14.99 subscription
    onetime:   'P6L48JKW53W5J', // $19.99 one-time
    bundle:    '6EXMRWBD9LCTQ'  // $54.99 bundle
  };

  // Elements
  const planEl = document.getElementById('plan');
  const qtyEl  = document.getElementById('qty');
  const totEl  = document.getElementById('totals');
  const venmoA = document.getElementById('lnkVenmo');
  const container = document.getElementById('paypal-container');

  // Prices + Venmo wiring (unchanged from before)
  const PRICES = { onetime: 19.99, subscribe: 14.99, bundle: 54.99 };
  const STORE_NAME = 'ET Naturals';
  const VENMO_HANDLE = 'etnaturals';

  const isMobile = () => /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  const planLabel = p => p==='subscribe' ? 'Subscription' : p==='bundle' ? 'Bundle (3-Pack)' : 'One-Time';

  function parseQueryPlan(){
    const p = new URLSearchParams(location.search).get('plan');
    if (p && ['onetime','subscribe','bundle'].includes(p)) planEl.value = p;
  }
  function calc(){
    const plan = planEl.value || 'onetime';
    const qty = Math.max(1, parseInt(qtyEl.value||'1',10));
    const unit = PRICES[plan] ?? PRICES.onetime;
    const total = +(unit * (plan==='subscribe' ? 1 : qty)).toFixed(2);
    return { plan, qty, unit, total };
  }
  function updateTotals(){
    const { total, qty, unit, plan } = calc();
    totEl.textContent = `Total: $${total.toFixed(2)} (${qty} × $${unit.toFixed(2)})` + (plan==='subscribe'?' / 30 days':'');
  }
  function updateVenmo(){
    const { plan, qty, total } = calc();
    const note = encodeURIComponent(`${STORE_NAME} — ${planLabel(plan)}${plan==='bundle'?'':(' ×'+qty)}`);
    const amount = total.toFixed(2);
    venmoA.href = isMobile()
      ? `venmo://paycharge?txn=pay&recipients=${encodeURIComponent(VENMO_HANDLE)}&amount=${amount}&note=${note}`
      : `https://venmo.com/${encodeURIComponent(VENMO_HANDLE)}?txn=pay&amount=${amount}&note=${note}`;
  }

  // Robust loader: wait for SDK, then render; re-render on plan change
  function whenPayPalReady(cb, tries=40){
    if (window.paypal && paypal.HostedButtons) return cb();
    if (tries <= 0) return console.warn('PayPal SDK not ready');
    setTimeout(() => whenPayPalReady(cb, tries-1), 150);
  }
  function renderPayPal(){
    const { plan } = calc();
    const id = BUTTON_IDS[plan];
    container.innerHTML = '';
    whenPayPalReady(() => {
      paypal.HostedButtons({ hostedButtonId: id })
        .render('#paypal-container')
        .catch(err => console.error('PayPal render error', err));
    });
  }

  // Init
  parseQueryPlan();
  updateTotals();
  updateVenmo();
  renderPayPal();

  // Events
  planEl.addEventListener('change', () => { updateTotals(); updateVenmo(); renderPayPal(); });
  qtyEl.addEventListener('input', () => { updateTotals(); updateVenmo(); });

  // (Optional) persist selection for thank-you page summary
  function saveOrderDraft(){
    const { plan, qty, unit, total } = calc();
    localStorage.setItem('etn_order', JSON.stringify({ plan, qty, unit, total, ts: new Date().toISOString() }));
  }
  // Call after totals update
  const _oldUpdateTotals = updateTotals;
  updateTotals = function(){ _oldUpdateTotals(); saveOrderDraft(); };
  // Run once to save current state
  saveOrderDraft();
})();
</script>

</body>
</html>
